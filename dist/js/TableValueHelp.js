sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,l){"use strict";return{handleTableValueHelp:async function(t){var l=this;var a=t.getSource();this._inputSource=a;this._inputId=a.getId();this._inputValue=a.getValue();this._inputField=a.getBindingInfo("value").parts[0].path;var i=a.oParent.oParent;var n=i.sId.split("--")[i.sId.split("--").length-1];var o=this.getOwnerComponent().getModel("ZGW_3DERP_COMMON_SRV");var s=this._aColumns[n.replace("Tab","")].filter(e=>e.ColumnName===this._inputField);var u=s[0].ValueHelp.items.path;var r=this._inputField,p=this._inputField;var g=s[0].TextFormatMode===undefined||s[0].TextFormatMode===""?"Key":s[0].TextFormatMode;var m=s[0].ValueHelp.columns;var h=this._oModelColumns[m];var d=this.getView().getModel(u).getData();var f=[],c=[];var V=this.getView().getModel("ddtext").getData();if(h!==undefined){h.forEach(e=>{if(e.Key)r=e.ColumnName;if(e.Value)p=e.ColumnName})}d.forEach(e=>{e.VHKey=e[r];e.VHValue=p===undefined||r===p?"":e[p];if(g==="Key"){e.VHSelected=this._inputValue===e[r]}else if(g==="Value"){e.VHSelected=this._inputValue===e[p]}else if(g==="KeyValue"){e.VHSelected=this._inputValue===e[r]+" ("+e[p]+")"}else if(g==="ValueKey"){e.VHSelected=this._inputValue===e[p]+" ("+e[r]+")"}});d.sort((e,t)=>e.VHKey>t.VHKey?1:-1);if(d.length>0){Object.keys(d[0]).filter(e=>e!=="__metadata"&&e!=="VHKey"&&e!=="VHValue"&&e!=="VHSelected").forEach(e=>{if(h!==undefined){var t=h.filter(t=>t.ColumnName===e);if(t&&t.length>0){if(t[0].Visible){f.push({ColumnName:t[0].ColumnName,ColumnLabel:t[0].ColumnName,Width:t[0].ColumnWidth,DataType:t[0].DataType,Visible:t[0].Visible})}}else{f.push({ColumnName:e,ColumnLabel:e})}}else{f.push({ColumnName:e,ColumnLabel:e})}})}else{if(h!==undefined){h.forEach(e=>{if(e.Visible){f.push({ColumnName:e.ColumnName,ColumnLabel:e.ColumnName,Width:e.ColumnWidth,DataType:e.DataType,Visible:e.Visible})}})}else{f.push({ColumnName:r,ColumnLabel:r});if(r!==p){f.push({ColumnName:p,ColumnLabel:p})}}}f.forEach(e=>{if(V[e.ColumnName]===undefined){c.push({CODE:e.ColumnName})}});var C=new Promise((t,a)=>{if(c.length>0){o.create("/CaptionMsgSet",{CaptionMsgItems:c},{method:"POST",success:function(a,i){a.CaptionMsgItems.results.forEach(e=>{V[e.CODE]=e.TEXT});l.getView().setModel(new e(V),"ddtext");t(V)},error:function(e){t(V)}})}else{t(V)}});V=await C;f.forEach(e=>{if(!(V[e.ColumnName]===undefined||V[e.ColumnName]==="")){e.ColumnLabel=V[e.ColumnName]}else{e.ColumnLabel=e.ColumnName}});var b={columns:f};var H=new e({title:s[0].ColumnLabel,count:d.length,textFormatMode:g});if(!this._tableValueHelpDialog){this._tableValueHelpDialog=sap.ui.xmlfragment("zuimatmaster.view.fragments.valuehelp.TableValueHelpDialog",this);this._tableValueHelpDialog.setModel(H);this.getView().addDependent(this._tableValueHelpDialog)}else{this._tableValueHelpDialog.setModel(H)}this._tableValueHelpDialog.open();var _=this._tableValueHelpDialog.getContent()[0].getAggregation("items")[0];_.attachCellClick(this._tableValueHelp.handleTableValueHelpSelect.bind(this));this._tableValueHelpDialog.getContent()[0].getItems()[0].getExtension()[0].getContent()[3].attachSearch(this._tableValueHelp.handleTableValueHelpFilter);this._tableValueHelpDialog.getButtons()[0].attachPress(this._tableValueHelp.handleTableValueHelpCancel.bind(this));_.getModel().setProperty("/columns",b.columns);_.bindColumns("/columns",function(e,t){var l=t.getObject().ColumnName;var a=t.getObject().ColumnLabel;var i=t.getObject().Width;var n=t.getObject().Visible;var o=t.getObject().DataType;var s;if(i===undefined||i==="0px"){if(b.columns.length===1)i="340px";else i="200px"}o=o!==undefined?o:"STRING";if(o.toUpperCase()==="STRING"){s=new sap.m.Text({text:"{"+t.getObject().ColumnName+"}",wrapping:false})}else{s=new sap.m.CheckBox({selected:"{"+t.getObject().ColumnName+"}",wrapping:false})}return new sap.ui.table.Column({label:new sap.m.Text({text:a}),template:s,autoResizable:true,width:i,sortProperty:l,visible:n!==undefined?n:true})});_.getModel().setProperty("/rows",d);_.bindRows("/rows");if(d.length>5){this._tableValueHelpDialog.setContentHeight("500px")}else{this._tableValueHelpDialog.setContentHeight("260px")}if(b.columns.length===1){this._tableValueHelpDialog.setContentWidth("375px")}else if(b.columns.length===2){this._tableValueHelpDialog.setContentWidth("435px")}else{this._tableValueHelpDialog.setContentWidth("645px")}this._tableValueHelpDialog.getContent()[0].getItems()[0].getExtension()[0].getContent()[3].setProperty("value","")},handleTableValueHelpSelect:function(e){var t=e.getParameters().rowBindingContext.sPath;this._inputSource.setSelectedKey(e.getSource().getModel().getProperty(t+"/VHKey"));this._inputSource.setValueState("None");this._tableValueHelpDialog.close()},handleTableValueHelpCancel:function(){this._tableValueHelpDialog.close()},handleTableValueHelpFilter:function(e){var a=e.getSource().oParent.oParent;var i=e.getParameter("query");var n=null;var o=[];if(i){a.getColumns().forEach(e=>{if(e.getAggregation("template").getBindingInfo("text")!==undefined){o.push(new t(e.getAggregation("template").getBindingInfo("text").parts[0].path,l.Contains,i))}else if(e.getAggregation("template").getBindingInfo("selected")!==undefined){o.push(new t(e.getAggregation("template").getBindingInfo("selected").parts[0].path,l.EQ,i))}});n=new t(o,false)}a.getBinding("rows").filter(n,"Application")}}});