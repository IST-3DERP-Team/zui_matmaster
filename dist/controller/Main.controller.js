sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","../js/Common","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/routing/HashChanger","sap/m/Token","sap/m/ColumnListItem","sap/m/Label","../js/TableValueHelp","../js/TableFilter","jquery.sap.global","sap/ui/Device"],function(e,t,s,a,i,r,l,o,n,d,u,g,c,h){"use strict";var f;var b=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/yyyy"});var m=sap.ui.core.format.DateFormat.getDateInstance({pattern:"YYYY-MM-dd"});var T=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyyMMdd"});var p=sap.ui.core.format.DateFormat.getTimeInstance({pattern:"KK:mm:ss a"});var M=new Date(0).getTimezoneOffset()*60*1e3;return e.extend("zuimatmaster.controller.Main",{onInit:function(){f=this;this._aColumns={};this._aDataBeforeChange=[];this._validationErrors=[];this._bHdrChanged=false;this._bDtlChanged=false;this._dataMode="READ";this._aColFilters=[];this._aColSorters=[];this._aMultiFiltersBeforeChange=[];this._aFilterableColumns={};this._oViewSettingsDialog={};this._sActiveTable="headerTab";this._oModel=this.getOwnerComponent().getModel();this._tableValueHelp=u;this._tableFilter=g;this._colFilters={};this.setSmartFilterModel();var e=this.getOwnerComponent().getModel("ZVB_3DERP_MM_FILTERS_CDS");e.read("/ZVB_3DERP_SBU_SH",{success:function(e,t){if(e.results.length===1){that.getView().getModel("ui").setProperty("/sbu",e.results[0].SBU)}else{}},error:function(e){}});this.getView().setModel(new t({acitveMatno:""}),"ui");this._counts={header:0,attributes:0,batch:0,customInfo:0,plant:0,unit:0};this.getView().setModel(new t(this._counts),"counts");this.byId("headerTab").setModel(new t({columns:[],rows:[]}));this.byId("attributesTab").setModel(new t({columns:[],rows:[]}));this.byId("batchTab").setModel(new t({columns:[],rows:[]}));this.byId("customInfoTab").setModel(new t({columns:[],rows:[]}));this.byId("plantTab").setModel(new t({columns:[],rows:[]}));this.byId("unitTab").setModel(new t({columns:[],rows:[]}));var s=[],a={};var e=this.getOwnerComponent().getModel("ZGW_3DERP_COMMON_SRV");s.push({CODE:"SBU"});s.push({CODE:"INFO_NO_RECORD_TO_PROC"});s.push({CODE:"INFO_NO_SEL_RECORD_TO_PROC"});s.push({CODE:"INFO_NO_LAYOUT"});s.push({CODE:"INFO_LAYOUT_SAVE"});s.push({CODE:"INFO_INPUT_REQD_FIELDS"});s.push({CODE:"CONFIRM_DISREGARD_CHANGE"});s.push({CODE:"INFO_SEL_RECORD_TO_DELETE"});s.push({CODE:"INFO_DATA_DELETED"});s.push({CODE:"CONF_DELETE_RECORDS"});s.push({CODE:"INFO_ERROR"});s.push({CODE:"INFO_NO_DATA_SAVE"});s.push({CODE:"INFO_DATA_SAVE"});s.push({CODE:"INFO_NO_DATA_EDIT"});s.push({CODE:"INFO_CHECK_INVALID_ENTRIES"});s.push({CODE:"ADD"});s.push({CODE:"EDIT"});s.push({CODE:"ADDROW"});s.push({CODE:"REMOVEROW"});s.push({CODE:"SAVE"});s.push({CODE:"CANCEL"});s.push({CODE:"DELETE"});s.push({CODE:"REFRESH"});s.push({CODE:"COPY"});s.push({CODE:"HASGMC"});s.push({CODE:"INFO_INPUT_REQD_FIELDS"});s.push({CODE:"INFO_NO_DATA_MODIFIED"});s.push({CODE:"INFO_DATA_COPIED"});e.create("/CaptionMsgSet",{CaptionMsgItems:s},{method:"POST",success:function(e,s){e.CaptionMsgItems.results.forEach(e=>{a[e.CODE]=e.TEXT});f.getView().setModel(new t(a),"ddtext")},error:function(e){}});var i={onkeyup:function(e){f.onKeyUp(e)},onAfterRendering:function(e){var t=e.srcControl;var s=t.sId.split("--")[t.sId.split("--").length-1];if(s.substr(s.length-3)==="Tab")f._tableRendered=s;else f._tableRendered="";f.onAfterTableRendering()},onclick:function(e){f.onTableClick(e)}};this.byId("headerTab").addEventDelegate(i);this.byId("attributesTab").addEventDelegate(i);this.byId("batchTab").addEventDelegate(i);this.byId("customInfoTab").addEventDelegate(i);this.byId("plantTab").addEventDelegate(i);this.byId("unitTab").addEventDelegate(i);this.getColumnProp();this.byId("headerTab").attachBrowserEvent("mousemove",function(e){});this._oModel.read("/MatTypeSHSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"MTYP_MODEL")},error:function(e){}});this._oModel.read("/MatGrpRscSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"MATERIALGRP_MODEL")},error:function(e){}});this._oModel.read("/UOMRscSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"BASEUOM_MODEL")},error:function(e){}});this._oModel.read("/WeightUnitSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"WTUOM_MODEL")},error:function(e){}});this._oModel.read("/VolumeUnitSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"VOLUOM_MODEL")},error:function(e){}});this._oModel.read("/ProcessRscSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"PROCESSCD_MODEL")},error:function(e){}});this._oModel.read("/DimensionUnitSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"DIMUOM_MODEL")},error:function(e){}});this._oModel.read("/PurValKeyRscSet",{async:false,success:function(e){f.getView().setModel(new t(e.results),"PURCHASEVALUE_MODEL")},error:function(e){}})},onSearch:function(){this.getMain()},setSmartFilterModel:function(){var e=this.getOwnerComponent().getModel("ZVB_3DERP_MM_FILTERS_CDS");var t=this.getView().byId("smartFilterBar");t.setModel(e)},getColumnProp:async function(){var e=c.sap.getModulePath("zuimatmaster","/model/columns.json");var s=new t;await s.loadData(e);var a=s.getData();this._oModelColumns=s.getData();setTimeout(()=>{this.getDynamicColumns("MMHDR","ZDVZERPMATL","headerTab",a)},100);setTimeout(()=>{this.getDynamicColumns("MMATTRIB","ZERP_MATATTRIB","attributesTab",a)},100);setTimeout(()=>{this.getDynamicColumns("MMBATCH","ZERP_MATBATCH","batchTab",a)},100);setTimeout(()=>{this.getDynamicColumns("MMCUSTOMINFO","ZERP_MATCUSINFO","customInfoTab",a)},100);setTimeout(()=>{this.getDynamicColumns("MMPLANT","MARC","plantTab",a)},100);setTimeout(()=>{this.getDynamicColumns("MMUNIT","ZDV_MAT_UNIT","unitTab",a)},100)},getDynamicColumns(e,s,a,i){var r=this;var l=e;var o=s;var n=a;var d=i;var u=this.getOwnerComponent().getModel("ZGW_3DERP_COMMON_SRV");var g="VER";u.setHeaders({sbu:g,type:l,tabname:o});u.read("/ColumnsSet",{success:function(e,s){if(e.results.length>0){if(d[n.replace("Tab","")]!==undefined){e.results.forEach(e=>{d[n.replace("Tab","")].filter(t=>t.ColumnName===e.ColumnName).forEach(t=>{e.ValueHelp=t.ValueHelp;e.TextFormatMode=t.TextFormatMode})})}r._aColumns[n.replace("Tab","")]=e.results;r.setTableColumns(n,e.results);var a=r.getView().getModel("ddtext").getData();e.results.forEach(e=>{a[e.ColumnName]=e.ColumnLabel});r.getView().setModel(new t(a),"ddtext")}},error:function(e){}})},setTableColumns(e,t){var s=e;var a=t;var i=this.getView().byId(s);i.getModel().setProperty("/columns",a);i.bindColumns("/columns",function(e,t){var a=t.getObject().ColumnName;var i=t.getObject().ColumnLabel;var r=t.getObject().ColumnWidth;var l=t.getObject().Visible;var o=t.getObject().Sorted;var n=t.getObject().SortOrder;var d=t.getObject().DataType;if(r===0)r=100;var u=new sap.m.Text({wrapping:false});var g=f._aColumns[s.replace("Tab","")].filter(e=>e.ColumnName===a);if(g&&g.length>0&&g[0].ValueHelp&&g[0].ValueHelp["items"].text&&g[0].ValueHelp["items"].value!==g[0].ValueHelp["items"].text&&g[0].TextFormatMode&&g[0].TextFormatMode!=="Key"){u.bindText({parts:[{path:a}],formatter:function(e){var t=f.getView().getModel(g[0].ValueHelp["items"].path).getData().filter(t=>t[g[0].ValueHelp["items"].value]===e);if(t&&t.length>0){if(g[0].TextFormatMode==="Value"){return t[0][g[0].ValueHelp["items"].text]}else if(g[0].TextFormatMode==="ValueKey"){return t[0][g[0].ValueHelp["items"].text]+" ("+e+")"}else if(g[0].TextFormatMode==="KeyValue"){return e+" ("+t[0][g[0].ValueHelp["items"].text]+")"}}else return e}})}else{u.bindText({parts:[{path:a}]})}if(s==="headerTab"){if(a==="HASGMC"){d="BOOLEAN"}else if(a==="UEBTK"){d="BOOLEAN"}}else if(s==="plantTab"){if(a==="LVORM"){d="BOOLEAN"}}return new sap.ui.table.Column({id:s.replace("Tab","")+"Col"+a,label:new sap.m.Text({text:i}),template:d==="BOOLEAN"?new sap.m.CheckBox({selected:"{"+a+"}",editable:false}):u,width:r+"px",sortProperty:a,autoResizable:true,visible:l,sorted:o,hAlign:d==="NUMBER"?"End":d==="BOOLEAN"?"Center":"Begin",sortOrder:o===true?n:"Ascending"})});i.attachSort(function(e){var t=e.getParameter("column").getSortProperty();var s=false;i.getColumns().forEach(e=>{if(e.getSorted()){e.setSorted(false)}});e.getParameter("column").setSorted(true);if(e.getParameter("sortOrder")==="Descending"){s=true;e.getParameter("column").setSortOrder("Descending")}else{e.getParameter("column").setSortOrder("Ascending")}var r=new sap.ui.model.Sorter(t,s);var l=a.filter(t=>t.ColumnName===e.getParameter("column").getProperty("sortProperty"));var o=l[0].DataType;if(o==="DATETIME"){r.fnCompare=function(e,t){var s=new Date(e);var a=new Date(t);if(a===null){return-1}if(s===null){return 1}if(s<a){return-1}if(s>a){return 1}return 0}}else if(o==="NUMBER"){r.fnCompare=function(e,t){var s=+e;var a=+t;if(a===null){return-1}if(s===null){return 1}if(s<a){return-1}if(s>a){return 1}return 0}}i.getBinding("rows").sort(r);e.preventDefault()});g.updateColumnMenu(s,this)},onTableClick(e){var t=e.srcControl;var s=t.sId.split("--")[t.sId.split("--").length-1];while(s.substr(s.length-3)!=="Tab"){t=t.oParent;s=t.sId.split("--")[t.sId.split("--").length-1]}if(this._dataMode==="READ")this._sActiveTable=s},onAfterTableRendering:function(e){if(this._tableRendered!==""){this.setActiveRowHighlightByTableId(this._tableRendered);this._tableRendered=""}},setActiveRowHighlightByTableId(e){var t=this.byId(e);setTimeout(()=>{var e=t.getModel().getData().rows.findIndex(e=>e.ACTIVE==="X");t.getRows().forEach(t=>{if(t.getBindingContext()&&+t.getBindingContext().sPath.replace("/rows/","")===e){t.addStyleClass("activeRow")}else t.removeStyleClass("activeRow")})},10)},getMain(){a.openLoadingDialog(this);var e=this.getOwnerComponent().getModel();var t=this.getView().byId("smartFilterBar").getFilters();console.log("aFilters",t);var s=this;var i="VER";e.read("/MaterialSet",{filters:t,success:function(e,t){if(e.results.length>0){e.results.sort((e,t)=>new Date(t.CREATEDDT)-new Date(e.CREATEDDT)||parseInt(t.MATERIALNO)-parseInt(e.MATERIALNO))}e.results.forEach((e,t)=>{e.HASGMC=e.HASGMC==="X"?true:false;if(e.CREATEDDT!==null)e.CREATEDDT=b.format(new Date(e.CREATEDDT));if(e.UPDATEDDATE!==null)e.UPDATEDDATE=b.format(new Date(e.UPDATEDDATE));if(t===0){f.getView().getModel("ui").setProperty("/acitveMatno",e.MATERIALNO);f.getAttributes(e.MATERIALNO);f.getBatch(e.MATERIALNO);f.getCustomInfo(e.MATERIALNO);f.getPlant(e.MATERIALNO);f.getUnit(e.MATERIALNO)}});f.byId("headerTab").getModel().setProperty("/rows",e.results);f.byId("headerTab").bindRows("/rows");f.getView().getModel("counts").setProperty("/header",e.results.length);a.closeLoadingDialog(f)},error:function(e){a.closeLoadingDialog(f)}})},getAttributes(e){var t=this.getOwnerComponent().getModel();var s="/MaterialAtrribSet";t.read(s,{urlParameters:{$filter:"MATNO eq '"+e+"'"},success:function(e,t){if(e.results.length>0){e.results.forEach(e=>{if(e.CREATEDDT!==null){e.CREATEDDT=b.format(new Date(e.CREATEDDT))}if(e.UPDATEDDT!==null){e.UPDATEDDT=b.format(new Date(e.UPDATEDDT))}})}f.byId("attributesTab").getModel().setProperty("/rows",e.results);f.byId("attributesTab").bindRows("/rows");f.getView().getModel("counts").setProperty("/attributes",e.results.length);a.closeLoadingDialog(f)},error:function(e){a.closeLoadingDialog(f)}})},getBatch(e){var t=this.getOwnerComponent().getModel();var s="/MaterialBatchSet";t.read(s,{urlParameters:{$filter:"MATNO eq '"+e+"'"},success:function(e,t){if(e.results.length>0){e.results.forEach(e=>{if(e.CREATEDDT!==null){e.CREATEDDT=b.format(new Date(e.CREATEDDT))}if(e.UPDATEDDT!==null){e.UPDATEDDT=b.format(new Date(e.UPDATEDDT))}})}f.byId("batchTab").getModel().setProperty("/rows",e.results);f.byId("batchTab").bindRows("/rows");f.getView().getModel("counts").setProperty("/batch",e.results.length);a.closeLoadingDialog(f)},error:function(e){a.closeLoadingDialog(f)}})},getCustomInfo(e){var t=this.getOwnerComponent().getModel();var s="/MaterialCusInfoSet";t.read(s,{urlParameters:{$filter:"MATNO eq '"+e+"'"},success:function(e,t){if(e.results.length>0){e.results.forEach(e=>{if(e.CREATEDDT!==null){e.CREATEDDT=b.format(new Date(e.CREATEDDT))}if(e.UPDATEDDT!==null){e.UPDATEDDT=b.format(new Date(e.UPDATEDDT))}})}f.byId("customInfoTab").getModel().setProperty("/rows",e.results);f.byId("customInfoTab").bindRows("/rows");f.getView().getModel("counts").setProperty("/customInfo",e.results.length);a.closeLoadingDialog(f)},error:function(e){a.closeLoadingDialog(f)}})},getPlant(e){var t=this.getOwnerComponent().getModel();var s="/PlantSet";t.read(s,{urlParameters:{$filter:"MATNR eq '"+e+"'"},success:function(e,t){if(e.results.length>0){e.results.forEach(e=>{if(e.CREATEDDT!==null){e.CREATEDDT=b.format(new Date(e.CREATEDDT))}if(e.UPDATEDDT!==null){e.UPDATEDDT=b.format(new Date(e.UPDATEDDT))}})}f.byId("plantTab").getModel().setProperty("/rows",e.results);f.byId("plantTab").bindRows("/rows");f.getView().getModel("counts").setProperty("/plant",e.results.length);a.closeLoadingDialog(f)},error:function(e){a.closeLoadingDialog(f)}})},getUnit(e){var t=this.getOwnerComponent().getModel();var s="/UnitMeasureSet";t.read(s,{urlParameters:{$filter:"MATNO eq '"+e+"'"},success:function(e,t){f.byId("unitTab").getModel().setProperty("/rows",e.results);f.byId("unitTab").bindRows("/rows");f.getView().getModel("counts").setProperty("/unit",e.results.length);a.closeLoadingDialog(f)},error:function(e){a.closeLoadingDialog(f)}})},onColFilterClear:function(e){g.onColFilterClear(e,this)},onColFilterCancel:function(e){g.onColFilterCancel(e,this)},onColFilterConfirm:function(e){g.onColFilterConfirm(e,this)},onFilterItemPress:function(e){g.onFilterItemPress(e,this)},onFilterValuesSelectionChange:function(e){g.onFilterValuesSelectionChange(e,this)},onSearchFilterValue:function(e){g.onSearchFilterValue(e,this)},onCustomColFilterChange:function(e){g.onCustomColFilterChange(e,this)},onSetUseColFilter:function(e){g.onSetUseColFilter(e,this)},onRemoveColFilter:function(e){g.onRemoveColFilter(e,this)},onRefresh:function(e){var t=e.getSource().oParent.oParent;var s=t.sId.split("--")[t.sId.split("--").length-1];this._sActiveTable=s;this.refreshData()},refreshData(){if(this._dataMode==="READ"){this._aColFilters=this.byId(this._sActiveTable).getBinding("rows").aFilters;this._aColSorters=this.byId(this._sActiveTable).getBinding("rows").aSorters;if(this._sActiveTable==="headerTab"){this.getMain()}else if(this._sActiveTable==="unitTab"){var e=this.getView().getModel("ui").getProperty("/acitveMatno");this.getUnit(e)}}},onCreate:function(e){var t=e.getSource().oParent.oParent;var s=t.sId.split("--")[t.sId.split("--").length-1];this._sActiveTable=s;this.onTableResize("Hdr","Max");this.createData()},createData(){if(this._dataMode==="READ"){if(this._sActiveTable==="headerTab"){this.byId("btnAddHdr").setVisible(false);this.byId("btnEditHdr").setVisible(false);this.byId("btnDeleteHdr").setVisible(false);this.byId("btnRefreshHdr").setVisible(false);this.byId("btnAddRowHdr").setVisible(true);this.byId("btnRemoveRowHdr").setVisible(true);this.byId("btnSaveHdr").setVisible(true);this.byId("btnCancelHdr").setVisible(true);this.byId("btnFullScreenHdr").setVisible(false);this.byId("btnExitFullScreenHdr").setVisible(false);this.byId("btnSettingsHdr").setVisible(false)}var e=this.byId(this._sActiveTable);this._aDataBeforeChange=c.extend(true,[],e.getModel().getData().rows);this._validationErrors=[];if(e.getBinding("rows").aApplicationFilters.length>0){this._aMultiFiltersBeforeChange=this._aFilterableColumns["gmc"].filter(e=>e.value!=="");e.getBinding("rows").filter("","Application")}if(e.getBinding("rows").aFilters.length>0){this._aColFilters=c.extend(true,[],e.getBinding("rows").aFilters);e.getBinding("rows").aFilters=[]}if(e.getBinding("rows").aSorters.length>0){this._aColSorters=c.extend(true,[],e.getBinding("rows").aSorters)}var t=e.getColumns();for(var s=0,a=t.length;s<a;s++){var i=t[s].getFiltered();if(i){t[s].filter("")}}this.setRowCreateMode()}},setRowCreateMode(){var e=this.byId(this._sActiveTable);var t=[];var s={};e.getColumns().forEach((e,t)=>{var a="";var i=false;if(e.mAggregations.template.mBindingInfos.text!==undefined){a=e.mAggregations.template.mBindingInfos.text.parts[0].path}else if(e.mAggregations.template.mBindingInfos.selected!==undefined){a=e.mAggregations.template.mBindingInfos.selected.parts[0].path}else if(e.mAggregations.template.mBindingInfos.value!==undefined){a=e.mAggregations.template.mBindingInfos.value.parts[0].path}this._aColumns[this._sActiveTable.replace("Tab","")].filter(e=>e.ColumnName===a).forEach(t=>{if(t.Editable||t.Creatable){if(t.ValueHelp!==undefined)i=t.ValueHelp["show"];if(i){var r=false;var l=t.ValueHelp["SuggestionItems"].text;var o=t.ValueHelp["SuggestionItems"].additionalText!==undefined?t.ValueHelp["SuggestionItems"].additionalText:"";var n="Key";if(t.TextFormatMode&&t.TextFormatMode!==""&&t.TextFormatMode!=="Key"&&t.ValueHelp["items"].value!==t.ValueHelp["items"].text){n=t.TextFormatMode;r=true;if(t.ValueHelp["SuggestionItems"].additionalText&&t.ValueHelp["SuggestionItems"].text!==t.ValueHelp["SuggestionItems"].additionalText){if(n==="ValueKey"||n==="Value"){l=t.ValueHelp["SuggestionItems"].additionalText;o=t.ValueHelp["SuggestionItems"].text}}}var d=new sap.m.Input({type:"Text",showValueHelp:true,valueHelpRequest:u.handleTableValueHelp.bind(this),showSuggestion:true,maxSuggestionWidth:t.ValueHelp["SuggestionItems"]?.additionalText?t.ValueHelp["SuggestionItems"].maxSuggestionWidth:"1px",suggestionItems:{path:t.ValueHelp["SuggestionItems"].path,length:1e4,template:new sap.ui.core.ListItem({key:t.ValueHelp["SuggestionItems"].text,text:l,additionalText:o}),templateShareable:false},change:this.handleValueHelpChange.bind(this)});if(r){d.setProperty("textFormatMode",n);d.bindValue({parts:[{path:a},{value:t.ValueHelp?.items?.path},{value:t.ValueHelp?.items?.value},{value:t.ValueHelp?.items?.text},{value:n}],formatter:this.formatValueHelp.bind(this)})}else{d.bindValue({parts:[{path:a}]})}e.setTemplate(d)}else if(t.DataType==="DATETIME"){if(this._sActiveTable==="costHdrTab"&&a==="CSDATE"){e.setTemplate(new sap.m.DatePicker({value:"{path: '"+t.ColumnName+"', mandatory: '"+t.Mandatory+"'}",displayFormat:"MM/dd/yyyy",valueFormat:"MM/dd/yyyy",change:this.onInputLiveChange.bind(this),enabled:{path:"COSTSTATUS",formatter:function(e){if(e==="REL"){return false}else{return true}}}}))}else{e.setTemplate(new sap.m.DatePicker({value:"{path: '"+t.ColumnName+"', mandatory: '"+t.Mandatory+"'}",displayFormat:"MM/dd/yyyy",valueFormat:"MM/dd/yyyy",change:this.onInputLiveChange.bind(this)}))}}else if(t.DataType==="NUMBER"){e.setTemplate(new sap.m.Input({type:sap.m.InputType.Number,textAlign:sap.ui.core.TextAlign.Right,value:"{path:'"+a+"', formatOptions:{ minFractionDigits:"+t.Decimal+", maxFractionDigits:"+t.Decimal+" }, constraints:{ precision:"+t.Length+", scale:"+t.Decimal+" }}",liveChange:this.onNumberLiveChange.bind(this)}))}else if(t.DataType==="BOOLEAN"){e.setTemplate(new sap.m.CheckBox({selected:"{"+a+"}",editable:true}))}else{if(this._sActiveTable==="ioMatListTab"&&a==="MATDESC1"){e.setTemplate(new sap.m.Input({type:"Text",value:"{"+a+"}",maxLength:t.Length,change:this.onInputLiveChange.bind(this),enabled:{path:"MATNO",formatter:function(e){if(e!==""){return false}else{return true}}}}))}else if(this._sActiveTable==="costHdrTab"&&a==="VERDESC"){e.setTemplate(new sap.m.Input({type:"Text",value:"{"+a+"}",maxLength:t.Length,change:this.onInputLiveChange.bind(this),enabled:{path:"COSTSTATUS",formatter:function(e){if(e==="REL"){return false}else{return true}}}}))}else{e.setTemplate(new sap.m.Input({type:"Text",value:"{"+a+"}",maxLength:t.Length,change:this.onInputLiveChange.bind(this)}))}}if(t.Mandatory){e.getLabel().addStyleClass("sapMLabelRequired")}if(t.DataType==="STRING")s[a]="";else if(t.DataType==="NUMBER")s[a]=0;else if(t.DataType==="BOOLEAN")s[a]=false}})});s["NEW"]=true;t=this.byId(this._sActiveTable).getModel().getProperty("/rows").filter(e=>e.NEW===true);t.push(s);this.byId(this._sActiveTable).getModel().setProperty("/rows",t);this.byId(this._sActiveTable).bindRows("/rows");this._dataMode="NEW";e.focus()},setRowReadMode(){var e=this.byId(this._sActiveTable);var t="";e.getColumns().forEach((e,s)=>{if(e.mAggregations.template.mBindingInfos.text!==undefined){t=e.mAggregations.template.mBindingInfos.text.parts[0].path}else if(e.mAggregations.template.mBindingInfos.selected!==undefined){t=e.mAggregations.template.mBindingInfos.selected.parts[0].path}else if(e.mAggregations.template.mBindingInfos.value!==undefined){t=e.mAggregations.template.mBindingInfos.value.parts[0].path}this._aColumns[this._sActiveTable.replace("Tab","")].filter(e=>e.ColumnName===t).forEach(s=>{if(s.TextFormatMode&&s.TextFormatMode!==""&&s.TextFormatMode!=="Key"&&s.ValueHelp&&s.ValueHelp["items"].text&&s.ValueHelp["items"].value!==s.ValueHelp["items"].text){e.setTemplate(new sap.m.Text({text:{parts:[{path:t}],formatter:function(e){var t=f.getView().getModel(s.ValueHelp["items"].path).getData().filter(t=>t[s.ValueHelp["items"].value]===e);if(t&&t.length>0){if(s.TextFormatMode==="Value"){return t[0][s.ValueHelp["items"].text]}else if(s.TextFormatMode==="ValueKey"){return t[0][s.ValueHelp["items"].text]+" ("+e+")"}else if(s.TextFormatMode==="KeyValue"){return e+" ("+t[0][s.ValueHelp["items"].text]+")"}}else return e}},wrapping:false}))}else if(s.DataType==="STRING"||s.DataType==="DATETIME"||s.DataType==="NUMBER"){e.setTemplate(new sap.m.Text({text:"{"+t+"}",wrapping:false}))}else if(s.DataType==="BOOLEAN"){e.setTemplate(new sap.m.CheckBox({selected:"{"+t+"}",editable:false}))}});e.getLabel().removeStyleClass("sapMLabelRequired")});this.byId(this._sActiveTable).getModel().getData().rows.forEach(e=>e.EDITED=false)},onTableResize(e,t){if(e==="Attr"){if(t==="Max"){this.byId("headerTab").setVisible(false);this.byId("btnFullScreenAttr").setVisible(false);this.byId("btnExitFullScreenAttr").setVisible(true)}else{this.byId("headerTab").setVisible(true);this.byId("btnFullScreenAttr").setVisible(true);this.byId("btnExitFullScreenAttr").setVisible(false)}}else if(e==="Unit"){if(t==="Max"){this.byId("headerTab").setVisible(false);this.byId("btnFullScreenUnit").setVisible(false);this.byId("btnExitFullScreenUnit").setVisible(true)}else{this.byId("headerTab").setVisible(true);this.byId("btnFullScreenUnit").setVisible(true);this.byId("btnExitFullScreenUnit").setVisible(false)}}else{if(t==="Max"){this.byId("itbDetail").setVisible(false);this.byId("btnFullScreenHdr").setVisible(false);this.byId("btnExitFullScreenHdr").setVisible(true)}else{this.byId("itbDetail").setVisible(true);this.byId("btnFullScreenHdr").setVisible(true);this.byId("btnExitFullScreenHdr").setVisible(false)}}},onInputLiveChange:function(e){var t=e.getSource();var s=t.getBindingInfo("value").binding.oContext.sPath;this.byId(this._sActiveTable).getModel().setProperty(s+"/EDITED",true);if(this._sActiveTable==="headerTab")this._bHdrChanged=true;else if(this._sActiveTable==="detailTab")this._bDtlChanged=true},onNumberLiveChange:function(e){var t=e.getSource();var s=t.getBindingInfo("value").constraints.scale;var a=t.getBindingInfo("value").constraints.precision;if(e.getParameters().value.split(".")[0].length>a-s){e.getSource().setValueState("Error");e.getSource().setValueStateText("Enter a number with a maximum whole number length of "+(a-s));if(this._validationErrors.filter(t=>t===e.getSource().getId()).length===0){this._validationErrors.push(e.getSource().getId())}}else if(e.getParameters().value.split(".").length>1){if(s===0){e.getSource().setValueState("Error");e.getSource().setValueStateText("Enter a number without decimal place/s");if(this._validationErrors.filter(t=>t===e.getSource().getId()).length===0){this._validationErrors.push(e.getSource().getId())}}else{if(e.getParameters().value.split(".")[1].length>s){e.getSource().setValueState("Error");e.getSource().setValueStateText("Enter a number with a maximum of "+s.toString()+" decimal places");if(this._validationErrors.filter(t=>t===e.getSource().getId()).length===0){this._validationErrors.push(e.getSource().getId())}}else{e.getSource().setValueState("None");this._validationErrors.forEach((t,s)=>{if(t===e.getSource().getId()){this._validationErrors.splice(s,1)}})}}}else{e.getSource().setValueState("None");this._validationErrors.forEach((t,s)=>{if(t===e.getSource().getId()){this._validationErrors.splice(s,1)}})}var i=t.getBindingInfo("value").binding.oContext.sPath;this.byId(this._sActiveTable).getModel().setProperty(i+"/EDITED",true);if(this._sActiveTable==="headerTab")this._bHdrChanged=true;else if(this._sActiveTable==="detailTab")this._bDtlChanged=true},handleValueHelpChange:function(e){var s=e.getSource();var a=s.oParent.getBindingContext().sPath;var i=!s.getSelectedKey()&&s.getValue().trim();var r=s.getBindingInfo("suggestionItems").model;var l="VER";s.getSuggestionItems().forEach(e=>{if(s.getSelectedKey()===""&&s.getValue()!==""){if(s.getProperty("textFormatMode")==="ValueKey"&&e.getProperty("text")+" ("+e.getProperty("key")+")"===s.getValue()){s.setSelectedKey(e.getProperty("key"));i=false;s.setValueState(i?"Error":"None")}else if((s.getProperty("textFormatMode")==="Value"||s.getProperty("textFormatMode")==="Key")&&e.getProperty("key")===s.getValue()){s.setSelectedKey(e.getProperty("key"));i=false;s.setValueState(i?"Error":"None")}}else if(e.getProperty("key")===s.getSelectedKey()){i=false;s.setValueState(i?"Error":"None")}});if(i)this._validationErrors.push(e.getSource().getId());else{const e=this.byId(this._sActiveTable).getModel();switch(r){case"MTYP_MODEL":var o=this.getView().byId("headerTab");var n=f.getView().getModel("MTYP_MODEL").getData().filter(e=>e.Mattyp===s.getSelectedKey());e.setProperty(a+"/HASGMC",n[0].Hasgmc==="X"?true:false);e.setProperty(a+"/GROSSWT","0.000");e.setProperty(a+"/NETWT","0.000");e.setProperty(a+"/VOLUME","0.000");e.setProperty(a+"/UEBTK",false);e.setProperty(a+"/MATERIALGROUP","");e.setProperty(a+"/GMC","");e.setProperty(a+"/BASEUOM","");e.setProperty(a+"/WTUOM","");e.setProperty(a+"/VOLUMEUOM","");e.setProperty(a+"/MATERIALGROUP","");e.setProperty(a+"/CUSTMATCODE","");e.setProperty(a+"/PROCESSCODE","");e.setProperty(a+"/UEBTO","");e.setProperty(a+"/UNTTO","");e.setProperty(a+"/UEBTK",false);if(n[0].Hasgmc==="X"){o.getColumns().forEach((e,t)=>{const s=e.getId().replace(this._sActiveTable.replace("Tab","")+"Col","");switch(s){case"MATERIALGROUP":case"GROSSWT":case"NETWT":case"WTUOM":case"VOLUME":case"VOLUMEUOM":case"CUSTMATLNO":case"PROCESSCODE":case"ORDERUOM":case"BASEUOM":case"GROSSWT":{o.getRows()[0].getCells()[t].setProperty("editable",false);break}case"GMC":{o.getRows()[0].getCells()[t].setProperty("editable",true);break}}});this._oModel.read("/GMCRscSet",{urlParameters:{$filter:"Mattyp eq '"+s.getSelectedKey()+"' and Sbu eq '"+l+"'"},async:false,success:function(e){f.getView().setModel(new t(e.results),"GMC_MODEL")},error:function(e){}})}else{o.getColumns().forEach((e,t)=>{const s=e.getId().replace(this._sActiveTable.replace("Tab","")+"Col","");switch(s){case"MATERIALGROUP":case"GROSSWT":case"NETWT":case"WTUOM":case"VOLUME":case"VOLUMEUOM":case"CUSTMATLNO":case"PROCESSCODE":case"ORDERUOM":case"BASEUOM":case"GROSSWT":{o.getRows()[0].getCells()[t].setProperty("editable",true);break}case"GMC":{o.getRows()[0].getCells()[t].setProperty("editable",false);break}}})}break;case"GMC_MODEL":var d=f.getView().getModel("GMC_MODEL").getData().filter(e=>e.Gmc===s.getSelectedKey());e.setProperty(a+"/MATERIALGROUP","");e.setProperty(a+"/BASEUOM","");e.setProperty(a+"/GROSSWT","");e.setProperty(a+"/NETWT","");e.setProperty(a+"/WTUOM","");e.setProperty(a+"/VOLUME","");e.setProperty(a+"/VOLUMEUOM","");e.setProperty(a+"/CUSTMATCODE","");e.setProperty(a+"/MATERIALGROUP",d[0].Matgrpcd);e.setProperty(a+"/BASEUOM",d[0].Baseuom);e.setProperty(a+"/GROSSWT",d[0].Grswt);e.setProperty(a+"/NETWT",d[0].Netwt);e.setProperty(a+"/WTUOM",d[0].Wtuom);e.setProperty(a+"/VOLUME",d[0].Volume);e.setProperty(a+"/VOLUMEUOM",d[0].Voluom);e.setProperty(a+"/CUSTMATCODE",d[0].Cusmatcd);break;case"PURCHASEVALUE_MODEL":var u=f.getView().getModel("PURCHASEVALUE_MODEL").getData().filter(e=>e.Ekwsl===s.getSelectedKey());e.setProperty(a+"/UEBTO","");e.setProperty(a+"/UNTTO","");e.setProperty(a+"/UEBTK",false);e.setProperty(a+"/UEBTO",u[0].Uebto);e.setProperty(a+"/UNTTO",u[0].Untto);e.setProperty(a+"/UEBTK",u[0].Uebtk==="X"?true:false);break}}this.byId(this._sActiveTable).getModel().setProperty(a+"/EDITED",true);if(this._sActiveTable==="headerTab")this._bHdrChanged=true;else if(this._sActiveTable==="detailTab")this._bDtlChanged=true},onAddRow(){this.setRowCreateMode()},onRemoveRow(){var e=this.byId(this._sActiveTable);var t=e.getModel().getProperty("/rows").filter(e=>e.NEW===true);t.splice(e.getSelectedIndices(),1);e.getModel().setProperty("/rows",t);e.bindRows("/rows")},onSaveHdr(){var e=this.byId(this._sActiveTable).getModel().getData().rows.filter(e=>e.NEW===true);var a=this.getOwnerComponent().getModel();var i=this.getOwnerComponent().getModel();var r=new t;var l=new t;var o="VER";var n={results:[]};e.forEach((e,t)=>{e.NEWSEQ=t});console.log("aNewRows",e);this.onMaterialTypeClassDialog(e);e.forEach((t,i)=>{a.read("/MRPTypeSet",{urlParameters:{$filter:"Screencode eq 'BAPI_MATNR' and Mtart eq '"+t.MATERIALTYPE+"'"},success:function(t,s){if(t.results.length>0){n.results.push(t.results[0])}if(i==e.length-1){r.setData(n);f.getView().setModel(r,"mrpTypeClass")}},error:function(e){s.information(e)}})});i.read("/MatPlantSet",{urlParameters:{$filter:"SBU eq '"+o+"'"},success:function(e,t){l.setData(e);f.getView().setModel(l,"matPlantClass")},error:function(e){}})},createDialog:null,onMaterialTypeClassDialog(e){var s=this.getOwnerComponent().getModel();var a=new t;var i=this;var r={results:[]};var l=e.map(e=>e.MATERIALTYPE);console.log("aMatType",l);l.forEach((e,o)=>{this.newMattyp=e;s.read("/MatTypeClassSet",{urlParameters:{$filter:"Mattyp eq '"+this.newMattyp+"'"},success:function(e,s){console.log(e);var n=JSON.parse(JSON.stringify(e));n.results.forEach(e=>{e.Descen="";e.Desczh="";e.Attrib=e.Attrib==="X"?true:false;e.Createddt=b.format(new Date(e.Createddt));e.Updateddt=b.format(new Date(e.Updateddt));e.DescInput=e.Attrib==="X"?false:true});r.results.push(...n.results);if(o==l.length-1){r.results.forEach((e,t)=>{e.NEWSEQ=t});a.setData(r);i.getView().setModel(a,"mtClassModel");i.createViewSettingsDialog("matTypeClass",new t({items:r.results,rowCount:r.results.length}));var d=i._oViewSettingsDialog["zuimatmaster.view.fragments.MaterialTypeClassDialog"];d.getModel().setProperty("/items",r.results);d.getModel().setProperty("/rowCount",r.results.length);d.open()}},error:function(e){}})})},createViewSettingsDialog:function(e,t){var s=null;if(e==="sort")s="zuimatmaster.view.SortDialog";else if(e==="filter")s="zuimatmaster.view.FilterDialog";else if(e==="column")s="zuimatmaster.view.ColumnDialog";else if(e==="matTypeClass")s="zuimatmaster.view.fragments.MaterialTypeClassDialog";var a=this._oViewSettingsDialog[s];if(!a){a=sap.ui.xmlfragment(s,this);if(h.system.desktop){a.addStyleClass("sapUiSizeCompact")}a.setModel(t);this._oViewSettingsDialog[s]=a;this.getView().addDependent(a)}else{a.setModel(t)}},onCreateMMCancel(){this._oViewSettingsDialog["zuimatmaster.view.fragments.MaterialTypeClassDialog"].close()},onCreateMMSave(){var e="VER";var t=[],i=[];var r=this;this.getView().getModel("mtClassModel").getData().results.forEach(e=>{if(e.Desczh==="")e.Desczh=e.Descen;if(e.Inclindesc==="X"){if(e.Descen!=="")t.push(e.Descen);if(e.Desczh!=="")i.push(e.Desczh)}});if(t.join("")===""){s.information("At least one description should be specified.")}else{a.openProcessingDialog(f,"Processing...");var l=this.byId(this._sActiveTable).getModel().getData().rows.filter(e=>e.NEW===true);var o="";var n=false;var d=0;l.forEach((u,g)=>{t=[];i=[];r.getView().getModel("mtClassModel").getData().results.forEach(e=>{if(e.Mattyp==u.MATERIALTYPE&&e.NEWSEQ==u.NEWSEQ){if(e.Desczh==="")e.Desczh=e.Descen;if(e.Inclindesc==="X"){if(e.Descen!=="")t.push(e.Descen);if(e.Desczh!=="")i.push(e.Desczh)}}});var c=t.join(", ");var h=i.join(", ");var b={};var m="";var T=[];var p=[];r.getView().getModel("mtClassModel").getData().results.forEach((e,t)=>{if(e.Mattyp==u.MATERIALTYPE&&e.NEWSEQ==u.NEWSEQ){p.push({Seq:"1",Seqno:t+1+"",Mattypcls:e.Mattypcls,Attribcd:e.Attribcd,Descen:e.Descen,Desczh:e.Desczh})}});var M=r.getView().getModel("mrpTypeClass").getData().results.filter(e=>e.Mtart==u.MATERIALTYPE)[0];T.push({Seq:"1",Seqno:"1",Ind_sector:"J",Matl_type:u.MATERIALTYPE,Matl_group:u.MATERIALGROUP,Old_mat_no:u.OLDMATERIALNO,Base_uom:u.BASEUOM,Batch_mgmt:"X",Net_weight:u.NETWT,Unit_of_wt:u.WTUOM,Po_unit:u.ORDERUOM,Pur_valkey:u.PURCHVALUEKEY,Plant:r.getView().getModel("matPlantClass").getData().results[0].PLANTCD,Mrp_type:M.Dismm,Period_ind:"M",Proc_type:"F",Availcheck:"KP",Profit_ctr:r.getView().getModel("matPlantClass").getData().results[0].PROFITCTR,Val_area:r.getView().getModel("matPlantClass").getData().results[0].PLANTCD,Price_ctrl:u.MATERIALGROUP==="ACC"||u.MATERIALGROUP==="FAB"?"V":"",Moving_pr:"0",Price_unit:"1",Val_class:M.Bklas});b={Seq:"1",Mattyp:u.MATERIALTYPE,Gmc:u.GMC,Descen:c,Desczh:h,Processcd:u.PROCESSCODE,Cusmatno:u.CUSMATCODE,Grswt:u.GROSSWT,Volume:u.VOLUME,Voluom:u.VOLUMEUOM,Length:u.LENGTH+"",Width:u.WIDTH+"",Height:u.HEIGHT+"",Dimuom:u.DIMENSIONUOM,Remarks:"",MatAttribParamSet:p,MatImportParamSet:T,RetMsgSet:[{Seq:"1"}]};console.log("_param",b);d+=100;setTimeout(()=>{var t=r.getOwnerComponent().getModel("ZGW_3DERP_MATERIAL_SRV");t.setHeaders({sbu:e});t.create("/MaterialHdrSet",b,{method:"POST",success:function(e,t){a.closeProcessingDialog(f);if(e.RetMsgSet.results[0].Type!="S")n=true;o+=e.RetMsgSet.results[0].Message+"\n";if(g==l.length-1){if(n==false){f._oViewSettingsDialog["zuimatmaster.view.fragments.MaterialTypeClassDialog"].close();f.getMain();f.onTableResize("Hdr","Min");f.byId("btnAddHdr").setVisible(true);f.byId("btnEditHdr").setVisible(true);f.byId("btnAddRowHdr").setVisible(false);f.byId("btnRemoveRowHdr").setVisible(false);f.byId("btnSaveHdr").setVisible(false);f.byId("btnCancelHdr").setVisible(false);f.byId("btnDeleteHdr").setVisible(true);f.byId("btnSettingsHdr").setVisible(true);f.byId("btnFullScreenHdr").setVisible(true);f.setRowReadMode();f._dataMode="READ"}s.information(o);a.closeProcessingDialog(f)}},error:function(){a.closeProcessingDialog(f)}})},d)})}},onCancel:function(e){var t=e.getSource().oParent.oParent;var s=t.sId.split("--")[t.sId.split("--").length-1];this._sActiveTable=s;this.cancelData()},cancelData(){if(this._dataMode==="NEW"||this._dataMode==="EDIT"){var e=false;if(this._sActiveTable==="headerTab")e=this._bHdrChanged;if(e){var s={Action:"update-cancel",Text:this.getView().getModel("ddtext").getData()["CONFIRM_DISREGARD_CHANGE"]};var a=new t;a.setData(s);if(!this._ConfirmDialog){this._ConfirmDialog=sap.ui.xmlfragment("zuimatmaster.view.fragments.dialog.ConfirmDialog",this);this._ConfirmDialog.setModel(a);this.getView().addDependent(this._ConfirmDialog)}else this._ConfirmDialog.setModel(a);this._ConfirmDialog.open()}else{if(this._sActiveTable==="headerTab"){f.byId("btnAddHdr").setVisible(true);f.byId("btnEditHdr").setVisible(true);f.byId("btnAddRowHdr").setVisible(false);f.byId("btnRemoveRowHdr").setVisible(false);f.byId("btnSaveHdr").setVisible(false);f.byId("btnCancelHdr").setVisible(false);f.byId("btnDeleteHdr").setVisible(true);f.byId("btnSettingsHdr").setVisible(true);f.byId("btnRefreshHdr").setVisible(true);f.byId("btnFullScreenHdr").setVisible(true);this.onTableResize("Hdr","Min")}this.byId(this._sActiveTable).getModel().setProperty("/rows",this._aDataBeforeChange);this.byId(this._sActiveTable).bindRows("/rows");if(this._aColFilters.length>0){this.setColumnFilters(this._sActiveTable)}if(this._aColSorters.length>0){this.setColumnSorters(this._sActiveTable)}this.setRowReadMode();this._dataMode="READ"}}},onCancelConfirmDialog:function(e){this._ConfirmDialog.close()},onCloseConfirmDialog:function(e){if(this._ConfirmDialog.getModel().getData().Action==="update-cancel"){if(this._sActiveTable==="headerTab"){f.byId("btnAddHdr").setVisible(true);f.byId("btnEditHdr").setVisible(true);f.byId("btnAddRowHdr").setVisible(false);f.byId("btnRemoveRowHdr").setVisible(false);f.byId("btnSaveHdr").setVisible(false);f.byId("btnCancelHdr").setVisible(false);f.byId("btnDeleteHdr").setVisible(true);f.byId("btnSettingsHdr").setVisible(true);f.byId("btnRefreshHdr").setVisible(true);f.byId("btnFullScreenHdr").setVisible(true);this.onTableResize("Hdr","Min")}this.byId(this._sActiveTable).getModel().setProperty("/rows",this._aDataBeforeChange);this.byId(this._sActiveTable).bindRows("/rows");if(this._aColFilters.length>0){this.setColumnFilters(this._sActiveTable)}if(this._aColSorters.length>0){this.setColumnSorters(this._sActiveTable)}this.setRowReadMode();this._dataMode="READ";this.setActiveRowHighlightByTableId(this._sActiveTable)}this._ConfirmDialog.close()},onCellClick:function(e){if(e.getParameters().rowBindingContext){var t=e.getSource();var s=e.getParameters().rowBindingContext.sPath;var i=t.getModel().getProperty(s+"/MATERIALNO");if(t.getId().indexOf("headerTab")>=0){a.openLoadingDialog(f);f.getView().getModel("ui").setProperty("/acitveMatno",i);f.getAttributes(i);f.getBatch(i);f.getCustomInfo(i);f.getPlant(i);f.getUnit(i);if(this._dataMode==="READ")this._sActiveTable="headerTab"}else{if(this._dataMode==="READ")this._sActiveTable="detailTab"}t.getModel().getData().rows.forEach(e=>e.ACTIVE="");t.getModel().setProperty(s+"/ACTIVE","X");t.getRows().forEach(e=>{if(e.getBindingContext()&&e.getBindingContext().sPath.replace("/rows/","")===s.replace("/rows/","")){e.addStyleClass("activeRow")}else e.removeStyleClass("activeRow")})}},onExtendMaterial:async function(){var e=this;var s=this.getOwnerComponent().getModel();var a=f.getView().getModel("ui").getProperty("/acitveMatno");var i="VER";var r={};var l=new t;var o=new t;var n=[];var d=[];var u=[];var g=[];await new Promise((e,t)=>{s.read("/ExtendMaterialChkSet",{urlParameters:{$filter:"MATNO eq '"+a+"'"},success:async function(t,s){console.log("ExtMatChk",t.results);n=t.results;e()},error:function(){e()}})});await new Promise((e,t)=>{s.read("/ExtendMaterialSet",{urlParameters:{$filter:"SBU eq '"+i+"'"},success:async function(t,s){console.log("ExtMat",t.results);d=t.results;e()},error:function(){e()}})});await new Promise((e,t)=>{d.filter(function(t,s){n.forEach(e=>{if(t.PLANTCD===e.PLANTCD){delete d[s]}});e()});d.forEach(e=>{g.push(e)});e()});l.setData(g);e.getView().setModel(l,"mmExtendTblData");console.log("mmExtendTblData",f.getView().getModel("mmExtendTblData").getData());r={Title:"Extend Material"};o.setData(r);e.onExtendMaterialDialog=sap.ui.xmlfragment(e.getView().getId(),"zuimatmaster.view.fragments.dialog.MMExtendDialog",e);e.onExtendMaterialDialog.setModel(o);e.getView().addDependent(e.onExtendMaterialDialog);var h=c.sap.getModulePath("zuimatmaster","/model/columns.json");var b=new t;await b.loadData(h);var m=b.getData();this._oModelColumns=b.getData();var T=new Promise((e,t)=>{e(this.getDynamicColumns("MMExtend","ZDV_MMEXTEND","mmExtendTbl",m))});await T;f.byId("mmExtendTbl").getModel().setProperty("/rows",f.getView().getModel("mmExtendTblData").getData());f.byId("mmExtendTbl").bindRows("/rows");e.onExtendMaterialDialog.open()},onCancelExtendMM:async function(){this.onExtendMaterialDialog.destroy(true)},onSaveExtendMaterial:async function(){var e=this;var t=this.getOwnerComponent().getModel();var i=this.getOwnerComponent().getModel("ZGW_3DERP_MATERIAL_SRV");var r=e.getView().getModel("ui").getProperty("/acitveMatno");var l=this.byId("mmExtendTbl");var o=l.getSelectedIndices();var n=[];var d=l.getModel().getData().rows;var u=false;var g="";var c=0;var h={};var b={};var m=[];if(o.length>0){a.openLoadingDialog(this);o.forEach(e=>{n.push(l.getBinding("rows").aIndices[e])});o=n;for(var T in o){await new Promise((e,s)=>{c++;t.read("/ExtendMaterialVldMatChkSet",{urlParameters:{$filter:"MATNO eq '"+r+"'"},success:async function(t,s){if(t.results.length>0){u=true;e(g=t.results[0].PLANTCD)}e()},error:function(){e()}})});if(u){b={Subrc:0};m.push({Row:0,Matnr:r,WerksFrom:g,WerksTo:d.at(T).PLANTCD})}if(o.length===c){h=b;h["N_IMatPlant"]=m;h["N_EMatPlant"]=[];h["N_Messtab"]=[];if(m.length>0){await new Promise((e,t)=>{i.create("/MatExtendSet",h,{method:"POST",success:function(t,a){const i=t.N_Messtab.results.length-1;if(t.N_Messtab.results[i].Type==="S"){s.information(t.N_Messtab.results[0].Message)}else if(t.N_Messtab.results[i].Type==="E"){s.error(Object.values(t.N_Messtab.results).pop().Message)}e()},error:function(t){e()}})})}else{s.error("No valid Purchasing Plant found.")}}}a.closeLoadingDialog(f);this.onExtendMaterialDialog.destroy(true);this.getPlant(r)}else{s.warning("No Selected Record!")}},onDelete:function(e){var t=e.getSource().oParent.oParent;var s=t.sId.split("--")[t.sId.split("--").length-1];this._sActiveTable=s;this.deleteData()},deleteData(){if(this._dataMode==="READ"){var e=this.byId(this._sActiveTable);var t=e.getSelectedIndices();var i=[];var r=e.getModel().getData().rows;if(t.length===0){s.information(this.getView().getModel("ddtext").getData()["INFO_NO_SEL_RECORD_TO_PROC"])}else{if(t.length>1){this.byId("headerTab").clearSelection();s.information("Please select one record only.")}else{t.forEach(t=>{i.push(e.getBinding("rows").aIndices[t])});t=i;s.confirm("Proceed to delete record?",{actions:["Yes","No"],onClose:function(e){if(e==="Yes"){a.openProcessingDialog(f,"Processing...");if(f.byId(f._sActiveTable).getBinding("rows").aFilters.length>0){f._aColFilters=f.byId(f._sActiveTable).getBinding("rows").aFilters}if(f.byId(f._sActiveTable).getBinding("rows").aSorters.length>0){f._aColSorters=f.byId(f._sActiveTable).getBinding("rows").aSorters}t.forEach(e=>{var t=f.getOwnerComponent().getModel();var s="/MaterialSet('"+r.at(e)["MATERIALNO"]+"')";var i={Deleted:"X"};t.update(s,i,{method:"PUT",success:function(t){f.getMain();a.closeProcessingDialog(f);sap.m.MessageBox.information("Material No : "+r.at(e)["MATERIALNO"]+" has been successfully deleted!")},error:function(e,t){a.closeProcessingDialog(f);sap.m.MessageBox.warning(e.message)}})})}}})}}}}})});